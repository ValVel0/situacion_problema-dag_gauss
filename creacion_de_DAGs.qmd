---
title: "imagenes de DAGs"
format: html
editor: visual
---

# Primera DAG

La primera DAG se construyó con una entrevista a la Dra. Mariana Sofía Flores Jiménez.

```{r}
library(tidyverse)
library(bnlearn)
```

```{r}
dag_1 = empty.graph(nodes = c("sexo", "edad", "entidad", 
                                 "valor_PCR", "valor_COLEST", "valor_COL_LDL", "valor_COL_HDL", 
                                 "valor_TRIG", "valor_GLU_SUERO", "valor_HB1AC", "valor_HB", "valor_CREAT",
                                 "SO_2", "CO", "NOx", "PM_010", "PM_2_5", "COV", "NH_3"))

arc_set1 = matrix(c(
  #demográficos con biomarcadores
  "sexo", "valor_COLEST",
  "sexo", "valor_COL_LDL",
  "sexo", "valor_COL_HDL",
  "sexo", "valor_TRIG",
  "sexo", "valor_GLU_SUERO",
  "sexo", "valor_CREAT",
  
  "edad", "valor_COLEST",
  "edad", "valor_COL_LDL",
  "edad", "valor_COL_HDL",
  "edad", "valor_TRIG",
  "edad", "valor_GLU_SUERO",
  "edad", "valor_CREAT",
  
  "entidad", "valor_COLEST",
  "entidad", "valor_TRIG",
  "entidad", "valor_GLU_SUERO",
  "entidad", "valor_COL_LDL",
  "entidad", "valor_COL_HDL",
  
  # interacciones biomarcadores
  "valor_GLU_SUERO", "valor_HB1AC",
  "valor_TRIG", "valor_COL_HDL",
  #"valor_COLEST", "valor_COL_LDL",
  
  # contaminantes individuales con biomarcadores
  "SO_2", "valor_TRIG",
  "SO_2", "valor_COLEST",
  "CO", "valor_GLU_SUERO",
  "CO", "valor_HB",
  "CO", "valor_COLEST",
  "PM_010", "valor_HB",
  "PM_010", "valor_GLU_SUERO",
  "PM_010", "valor_HB1AC",
  "PM_2_5", "valor_HB",
  "PM_2_5", "valor_GLU_SUERO",
  "PM_2_5", "valor_HB1AC",
  "COV", "valor_COLEST",
  "COV", "valor_TRIG",
  "COV", "valor_GLU_SUERO",
  "NH_3", "valor_COLEST",
  "NH_3", "valor_TRIG",
  "NH_3", "valor_GLU_SUERO",
  
  # contaminantes combinados --> inflamación
  # Aunque la pregunta 14 no fue respondida, de la pregunta 19, se puede deducir que un biomarcador de estrés oxidativo indirecto es la proteína C
  
  "SO_2", "valor_PCR",
  "CO", "valor_PCR",
  "NOx", "valor_PCR",
  "PM_010", "valor_PCR",
  "PM_2_5", "valor_PCR",
  "COV", "valor_PCR",
  "NH_3", "valor_PCR"

  
), byrow = TRUE, ncol = 2,
dimnames = list(NULL, c("from", "to")))

# arcos de DAG
arcs(dag_1) = arc_set1

dag_1
```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(dag_1, shape = "ellipse")
```

```{r}
# guardamos la imagen
png("figures/diagrama_dag_1.png", width = 1200, height = 800, res = 150)
graphviz.plot(dag_1, shape = "ellipse")
dev.off()
```

### Guardamos como un objeto

```{r}
save(dag_1, file = "objetos/dag_1.RData")
```

# Segunda DAG

La segunda DAG se contruyó con las respuestas de la entrevista al Rafael Alberto Pérez San Lázaro

```{r}

# en esta entrevista, la entidad federativa no tiene ninguna relación
dag_2 = empty.graph(nodes = c("sexo", "edad", "entidad", 
                                 "valor_PCR", "valor_COLEST", "valor_COL_LDL", "valor_COL_HDL", 
                                 "valor_TRIG", "valor_GLU_SUERO", "valor_HB1AC", "valor_HB", "valor_CREAT",
                                 "SO_2", "CO", "NOx", "PM_010", "PM_2_5", "COV", "NH_3"))

arc_set2 <- matrix(c(
  
  #demográficos con biomarcadores
  "sexo", "valor_COLEST",
  "sexo", "valor_COL_LDL",
  "sexo", "valor_COL_HDL",
  "sexo", "valor_TRIG",
  "sexo", "valor_GLU_SUERO",
  "sexo", "valor_CREAT",
  
  "edad", "valor_COLEST",
  "edad", "valor_COL_LDL",
  "edad", "valor_COL_HDL",
  "edad", "valor_TRIG",
  "edad", "valor_GLU_SUERO",
  "edad", "valor_CREAT",
  
  # interacciones biomarcadores
  "valor_GLU_SUERO", "valor_HB1AC",
  "valor_COLEST", "valor_COL_LDL",
  "valor_TRIG", "valor_COL_HDL",
  "valor_TRIG", "valor_COL_LDL",
  
  "sexo", "valor_CREAT",
  "edad", "valor_CREAT",
  "valor_HB", "valor_CREAT",
  
  # contaminantes --> biomarcadores
  "SO_2", "valor_TRIG",
  "SO_2", "valor_COLEST",
  "CO", "valor_GLU_SUERO",
  "CO", "valor_HB",
  "CO", "valor_COLEST",
  "NOx", "valor_PCR",
  "PM_010", "valor_HB",
  "PM_010", "valor_GLU_SUERO",
  "PM_010", "valor_HB1AC",
  "PM_2_5", "valor_HB",
  "PM_2_5", "valor_GLU_SUERO",
  "PM_2_5", "valor_HB1AC",
  "COV", "valor_COLEST",
  "COV", "valor_TRIG",
  "COV", "valor_GLU_SUERO",
  "NH_3", "valor_COLEST",
  "NH_3", "valor_TRIG",
  "NH_3", "valor_GLU_SUERO",
  
  # biomarcadores + contaminantes --> PCR
  #"edad", "valor_COL_LDL",
  #"edad", "valor_TRIG",
  "SO_2", "valor_PCR",
  "CO", "valor_PCR",
  "NOx", "valor_PCR",
  "PM_010", "valor_PCR",
  "PM_2_5", "valor_PCR",
  "COV", "valor_PCR",
  "NH_3", "valor_PCR",
  "valor_PCR", "valor_TRIG",
  "valor_PCR", "valor_GLU_SUERO",
  "valor_PCR", "valor_HB1AC",
  "valor_PCR", "valor_COL_HDL"
  
  
), byrow = TRUE, ncol = 2,
dimnames = list(NULL, c("from", "to")))

# arcos de DAG
arcs(dag_2) = arc_set2

dag_2

```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(dag_2, shape = "ellipse")
```

```{r}
# guardamos la imagen
png("figures/diagrama_dag_2.png", width = 1200, height = 800, res = 150)
graphviz.plot(dag_2, shape = "ellipse")
dev.off()
```

### Guardamos como objeto

```{r}
save(dag_2, file = "objetos/dag_2.RData")
```

# Tercera DAG

La tercera DAG se construyo con ayuda de la Dra. Beatriz Adriana Barragán Castillo por medio de una consulta sobre las emisiones y sus afectaciones en los biomarcadores.

```{r}
# Al igual que en la segunda DAG, la entidad no tiene ninguna relación.
dag_3 = empty.graph(nodes = c("sexo", "edad", "entidad", 
                                 "valor_PCR", "valor_COLEST", "valor_COL_LDL", "valor_COL_HDL", 
                                 "valor_TRIG", "valor_GLU_SUERO", "valor_HB1AC", "valor_HB", "valor_CREAT",
                                 "SO_2", "CO", "NOx", "PM_010", "PM_2_5", "COV", "NH_3"))

arc_set3 <- matrix(c(
  #Demográficos con biomarcadores
  "sexo", "valor_HB",
  "sexo", "valor_PCR",
  "sexo", "valor_COLEST",
  "sexo", "valor_COL_LDL",
  "sexo", "valor_COL_HDL",
  "sexo", "valor_TRIG",
  "sexo", "valor_GLU_SUERO",
  "sexo", "valor_HB1AC",
  "sexo", "valor_CREAT",
  "edad", "valor_HB",
  "edad", "valor_PCR",
  "sexo", "valor_COLEST",
  "edad", "valor_COL_LDL",
  "edad", "valor_COL_HDL",
  "edad", "valor_TRIG",
  "edad", "valor_GLU_SUERO",
  "edad", "valor_HB1AC",
  "edad", "valor_CREAT",
  #Emisiones + biomarcadores:
  "NH_3", "valor_HB",
  "NH_3", "valor_CREAT",
  "NH_3", "valor_PCR",
  "NH_3", "valor_COLEST",
  "NH_3", "valor_COL_LDL",
  "NH_3", "valor_COL_HDL",
  "NH_3", "valor_TRIG",
  "CO", "valor_HB",
  "SO_2", "valor_PCR",
  "SO_2", "valor_CREAT",
  "NOx", "valor_PCR",
  "NOx", "valor_TRIG",
  "NOx", "valor_COLEST",
  "PM_010", "valor_PCR",
  "PM_010", "valor_COLEST",
  "PM_2_5", "valor_PCR",
  "PM_2_5", "valor_COLEST",
  "COV", "valor_PCR",
  "COV", "valor_COLEST"
), byrow = TRUE, ncol = 2,
dimnames = list(NULL, c("from", "to")))

# arcos de DAG
arcs(dag_3) = arc_set3

dag_3
```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(dag_3, shape = "ellipse")
```

```{r}
# guardamos la imagen
png("figures/diagrama_dag_3.png", width = 1200, height = 800, res = 150)
graphviz.plot(dag_3, shape = "ellipse")
dev.off()
```

### Guardamos como objeto

```{r}
save(dag_3, file = "objetos/dag_3.RData")
```

# Cargar bases de datos

```{r}
df_final = read_delim("data/dataset.csv")
```

```{r}
df_final$estrato <- NULL
head(df_final)
glimpse(df_final)
```

```{r}
df_knn3 = read_delim("data/k3_dataset.csv")
```

```{r}
df_knn3$estrato <- NULL
head(df_knn3)
glimpse(df_knn3)
```

## Comparacion de DAGS

#ver si hay una diferencia de variables entre las dags y las bases de datos 

```{r}
# creacion de conteo de vraibles

# dags

dag1_vars <- nodes(dag_1)

dag2_vars <- nodes(dag_2)

dag3_vars <- nodes(dag_3)

# dataframes

df_final_vars <- names(df_final)
df_knn3_vars <- names(df_knn3)

```

```{r}
# comparacion de variables 

# DAG 1

# df_final comparacion

cat("Compracion Dag 1 con df_final:\n")

# Variables en el DAG pero no en los datos
missing_in_data <- setdiff(dag1_vars, df_final_vars)
cat("Variables en el DAG_1 pero no en df_final:\n")
cat(paste(missing_in_data, collapse = " "), "\n\n")


# Variables en los datos pero no en el DAG
extra_in_data <- setdiff(df_final_vars, dag1_vars)
cat("Variables en df_final pero no en el DAG_1:\n")
cat(paste(extra_in_data, collapse = " "), "\n\n")

# df_knn3 comparacion 

cat("Compracion Dag 1 con df_knn3:\n")

# Variables en el DAG pero no en los datos
missing_in_data <- setdiff(dag1_vars, df_knn3_vars)
cat("Variables en el DAG_1 pero no en df_knn3:\n")
cat(paste(missing_in_data, collapse = " "), "\n\n")


# Variables en los datos pero no en el DAG
extra_in_data <- setdiff(df_knn3_vars, dag1_vars)
cat("Variables en df_knn3 pero no en el DAG_1:\n")
cat(paste(extra_in_data, collapse = " "), "\n\n")

# DAG 2

# df_final comparacion

cat("Compracion Dag 2 con df_final:\n")

# Variables en el DAG pero no en los datos
missing_in_data <- setdiff(dag2_vars, df_final_vars)
cat("Variables en el DAG_2 pero no en df_final:\n")
cat(paste(missing_in_data, collapse = " "), "\n\n")


# Variables en los datos pero no en el DAG
extra_in_data <- setdiff(df_final_vars, dag2_vars)
cat("Variables en df_final pero no en el DAG_2:\n")
cat(paste(extra_in_data, collapse = " "), "\n\n")

# df_knn3 comparacion 

cat("Compracion Dag 2 con df_knn3:\n")

# Variables en el DAG pero no en los datos
missing_in_data <- setdiff(dag2_vars, df_knn3_vars)
cat("Variables en el DAG_2 pero no en df_knn3:\n")
cat(paste(missing_in_data, collapse = " "), "\n\n")


# Variables en los datos pero no en el DAG
extra_in_data <- setdiff(df_knn3_vars, dag2_vars)
cat("Variables en df_knn3 pero no en el DAG_2:\n")
cat(paste(extra_in_data, collapse = " "), "\n\n")

# DAG 3

# df_final comparacion

cat("Compracion Dag 3 con df_final:\n")

# Variables en el DAG pero no en los datos
missing_in_data <- setdiff(dag3_vars, df_final_vars)
cat("Variables en el DAG_3 pero no en df_final:\n")
cat(paste(missing_in_data, collapse = " "), "\n\n")


# Variables en los datos pero no en el DAG
extra_in_data <- setdiff(df_final_vars, dag3_vars)
cat("Variables en df_final pero no en el DAG_3:\n")
cat(paste(extra_in_data, collapse = " "), "\n\n")

# df_knn3 comparacion 

cat("Compracion Dag 3 con df_knn3:\n")

# Variables en el DAG pero no en los datos
missing_in_data <- setdiff(dag3_vars, df_knn3_vars)
cat("Variables en el DAG_3 pero no en df_knn3:\n")
cat(paste(missing_in_data, collapse = " "), "\n\n")


# Variables en los datos pero no en el DAG
extra_in_data <- setdiff(df_knn3_vars, dag3_vars)
cat("Variables en df_knn3 pero no en el DAG_3:\n")
cat(paste(extra_in_data, collapse = " "), "\n")

```

# ver fuerza de los dags 



`
# score de los dags 



